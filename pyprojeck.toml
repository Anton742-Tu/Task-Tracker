[tool.poetry]
name = "task-tracker-backend"
version = "0.1.0"
description = "Django backend for Task Tracker"
authors = ["Anton Tumashov <Tumashovster@Gmail.com>"]
readme = "README.md"
packages = [{include = "backend"}]

[tool.poetry.dependencies]
python = "^3.12"
django = "^5.0"
djangorestframework = "^3.14"
psycopg2-binary = "^2.9"
python-dotenv = "^1.0"
django-cors-headers = "^4.3"
drf-yasg = "^1.21"
django-filter = "^23.5"
whitenoise = "^6.6"
django-debug-toolbar = "^4.3"
djangorestframework-simplejwt = "^5.3"
Pillow = "^12.0.0"
python-magic-bin = "^0.4.14"

[tool.poetry.group.dev.dependencies]
pytest = "^7.4"
pytest-django = "^4.7"
pytest-cov = "^4.1"
black = "^23.11"
flake8 = "^6.1"
mypy = "^1.7"
isort = "^5.13"
pre-commit = "^3.6"

[tool.poetry.scripts]
start = "python manage.py runserver"
test = "pytest"

[build-system]
requires = ["poetry-core"]
build-backend = "poetry.core.masonry.api"

[tool.black]
line-length = 119
target-version = ["py312"]
include = '\.pyi?$'
extend-exclude = '''
/(
  \.eggs
  | \.git
  | \.hg
  | \.mypy_cache
  | \.tox
  | \.venv
  | _build
  | buck-out
  | build
  | dist
)/
'''

[tool.isort]
profile = "black"
line_length = 119
multi_line_output = 3
include_trailing_comma = true
force_grid_wrap = 0
use_parentheses = true
ensure_newline_before_comments = true
known_first_party = ["backend"]
sections = ["FUTURE", "STDLIB", "THIRDPARTY", "FIRSTPARTY", "LOCALFOLDER"]
default_section = "THIRDPARTY"
lines_after_imports = 2

[tool.mypy]
python_version = "3.12"
warn_return_any = true
disallow_untyped_defs = false
check_untyped_defs = true
no_implicit_optional = true

# Игнорировать конкретные ошибки на старте
disable_error_code = [
    "var-annotated",  # Игнорировать отсутствие аннотаций переменных
    "dict-item",      # Игнорировать проблемы с dict
]

[[tool.mypy.overrides]]
module = [
    "django.*",
    "rest_framework.*",
]
ignore_missing_imports = true

[tool.pytest.ini_options]
DJANGO_SETTINGS_MODULE = "backend.settings"
python_files = ["tests.py", "test_*.py", "*_tests.py"]
addopts = [
    "--strict-markers",
    "--tb=short",
    "--cov=backend",
    "--cov-report=term-missing",
    "--cov-report=html",
    "--cov-report=xml",
]
testpaths = ["apps", "api"]
markers = [
    "slow: marks tests as slow (deselect with '-m \"not slow\"')",
    "integration: integration tests",
    "unit: unit tests",
    "api: API tests",
]