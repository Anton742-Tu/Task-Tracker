{% extends "base.html" %}

{% block title %}–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">‚ûï –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É</h4>
                </div>
                <div class="card-body">
                    <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
                    {% if messages %}
                    <div class="mb-3">
                        {% for message in messages %}
                        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}

                    <form method="post" action="{% url 'tasks:create_task' %}">
                        {% csrf_token %}

                        <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ -->
                        <div class="mb-3">
                            <label for="title" class="form-label">
                                <strong>–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ *</strong>
                            </label>
                            <input type="text"
                                   class="form-control"
                                   id="title"
                                   name="title"
                                   required
                                   placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏">
                        </div>

                        <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
                        <div class="mb-3">
                            <label for="description" class="form-label">
                                <strong>–û–ø–∏—Å–∞–Ω–∏–µ</strong>
                            </label>
                            <textarea class="form-control"
                                      id="description"
                                      name="description"
                                      rows="4"
                                      placeholder="–û–ø–∏—à–∏—Ç–µ –∑–∞–¥–∞—á—É –ø–æ–¥—Ä–æ–±–Ω–µ–µ..."></textarea>
                        </div>

                        <div class="row">
                            <!-- –ü—Ä–æ–µ–∫—Ç -->
                            <div class="col-md-6 mb-3">
                                <label for="project" class="form-label">
                                    <strong>–ü—Ä–æ–µ–∫—Ç</strong>
                                </label>
                                <select class="form-select" id="project" name="project">
                                    <option value="">–ë–µ–∑ –ø—Ä–æ–µ–∫—Ç–∞</option>
                                    {% for project in projects %}
                                        <option value="{{ project.id }}">
                                            {{ project.name }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>

                            <!-- –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å -->
                            <div class="col-md-6 mb-3">
                                <label for="assignee" class="form-label">
                                    <strong>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å</strong>
                                </label>
                                <select class="form-select" id="assignee" name="assignee">
                                    <option value="">–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–æ</option>
                                    {% for user in users %}
                                        <option value="{{ user.id }}">
                                            {{ user.get_full_name|default:user.username }}
                                            {% if user == request.user %} (–í—ã) {% endif %}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <div class="row">
                            <!-- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç -->
                            <div class="col-md-6 mb-3">
                                <label for="priority" class="form-label">
                                    <strong>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</strong>
                                </label>
                                <select class="form-select" id="priority" name="priority">
                                    <option value="low">üîµ –ù–∏–∑–∫–∏–π</option>
                                    <option value="medium" selected>üü° –°—Ä–µ–¥–Ω–∏–π</option>
                                    <option value="high">üü† –í—ã—Å–æ–∫–∏–π</option>
                                    <option value="critical">üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π</option>
                                </select>
                            </div>

                            <!-- –°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è -->
                            <div class="col-md-6 mb-3">
                                <label for="due_date" class="form-label">
                                    <strong>–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</strong>
                                </label>
                                <input type="date"
                                       class="form-control"
                                       id="due_date"
                                       name="due_date"
                                       min="{{ today|date:'Y-m-d' }}">
                            </div>
                        </div>

                        <!-- –ö–Ω–æ–ø–∫–∏ -->
                        <div class="d-flex justify-content-between mt-4">
                            <a href="{% url 'home' %}" class="btn btn-secondary">
                                ‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é
                            </a>
                            <div>
                                <a href="/admin/tasks/task/add/" class="btn btn-outline-primary me-2" target="_blank">
                                    üìã –°–æ–∑–¥–∞—Ç—å –≤ –∞–¥–º–∏–Ω–∫–µ
                                </a>
                                <button type="submit" class="btn btn-success">
                                    ‚úÖ –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- –ü–æ–¥—Å–∫–∞–∑–∫–∏ -->
            <div class="alert alert-info mt-3">
                <h5>üí° –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—É—é –∑–∞–¥–∞—á—É:</h5>
                <ul class="mb-0">
                    <li><strong>–ù–∞–∑–≤–∞–Ω–∏–µ</strong> - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–Ω—è—Ç–Ω—ã–º –∏ –∫—Ä–∞—Ç–∫–∏–º</li>
                    <li><strong>–û–ø–∏—Å–∞–Ω–∏–µ</strong> - –¥–µ—Ç–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ, —á—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å</li>
                    <li><strong>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å</strong> - –µ—Å–ª–∏ –Ω–µ –Ω–∞–∑–Ω–∞—á–∏—Ç—å, –∑–∞–¥–∞—á–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤—Å–µ–º</li>
                    <li><strong>–°—Ä–æ–∫</strong> - —É–∫–∞–∂–∏—Ç–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –¥–µ–¥–ª–∞–π–Ω</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–∞—Ç—ã -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É –∫–∞–∫ –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –¥–ª—è —Å—Ä–æ–∫–∞
    const today = new Date().toISOString().split('T')[0];
    const dueDateInput = document.getElementById('due_date');
    if (dueDateInput && !dueDateInput.value) {
        dueDateInput.min = today;
    }

    // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –Ω–∞–∑–≤–∞–Ω–∏—è
    document.getElementById('title').focus();
});
</script>
{% endblock %}
